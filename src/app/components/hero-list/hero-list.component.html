<div class="hero-list-container">
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>Superhéroes</h1>
      <p>Explora nuestra lista de superhéroes</p>
    </header>

    <!-- Controls -->
    <div class="controls">
      <div class="controls-inner">
        <div>
          <span class="text-gray-700">Mostrar</span>
          <select [(ngModel)]="pageSize" (change)="changePageSize(pageSize)" 
                  class="page-size-select">
            <option [value]="5">5</option>
            <option [value]="10">10</option>
            <option [value]="20">20</option>
            <option [value]="50">50</option>
          </select>
          <span class="text-gray-700">héroes por página</span>
        </div>
        
        <div class="stats">
          Mostrando 
          <strong>{{ (currentPage - 1) * pageSize + 1 }}</strong> - 
          <strong>{{ getMin(currentPage * pageSize, totalItems) }}</strong> de 
          <strong>{{ totalItems }}</strong> héroes
        </div>
      </div>
    </div>

    <!-- Loading State con Skeleton -->
    <div *ngIf="isLoading" class="hero-grid">
      <!-- Skeleton loading para 8 tarjetas -->
      <div *ngFor="let i of [1,2,3,4,5,6,7,8]" class="skeleton-card">
        <div class="skeleton skeleton-image"></div>
        <div class="skeleton skeleton-text"></div>
        <div class="skeleton skeleton-text-small"></div>
        <div class="skeleton skeleton-text-small"></div>
        <div class="skeleton skeleton-button"></div>
      </div>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !isLoading" class="error">
      {{ error }}
      <button (click)="loadHeroes()" class="btn btn-primary" style="margin-left: 1rem;">
        Reintentar
      </button>
    </div>

    <!-- Hero Grid con trackBy y lazy loading -->
    <div *ngIf="!isLoading && !error && heroes.length > 0" class="hero-grid">
      <div *ngFor="let hero of heroes; trackBy: trackByHeroId" 
           [routerLink]="['/hero', hero.id]"
           class="hero-card">
        
        <!-- Hero Image con lazy loading -->
        <div class="hero-image-container">
          <img [src]="getHeroImage(hero)" 
               [alt]="hero.name"
               class="hero-image"
               loading="lazy"> <!-- OPTIMIZACIÓN: lazy loading -->
          <div class="hero-id">
            #{{ hero.id }}
          </div>
        </div>
        
        <!-- Hero Info -->
        <div class="hero-info">
          <h2 class="hero-name">{{ hero.name }}</h2>
          
          <!-- Power Stats -->
          <div class="power-stats">
            <div class="stat-row">
              <span class="stat-label">Inteligencia:</span>
              <div class="stat-bar-container">
                <div class="stat-bar" 
                     [style.width.%]="hero.powerstats.intelligence"
                     style="background-color: #2563eb;"></div>
              </div>
              <span class="stat-value">{{ hero.powerstats.intelligence }}</span>
            </div>
            
            <div class="stat-row">
              <span class="stat-label">Fuerza:</span>
              <div class="stat-bar-container">
                <div class="stat-bar" 
                     [style.width.%]="hero.powerstats.strength"
                     style="background-color: #dc2626;"></div>
              </div>
              <span class="stat-value">{{ hero.powerstats.strength }}</span>
            </div>
            
            <div class="stat-row">
              <span class="stat-label">Velocidad:</span>
              <div class="stat-bar-container">
                <div class="stat-bar" 
                     [style.width.%]="hero.powerstats.speed"
                     style="background-color: #16a34a;"></div>
              </div>
              <span class="stat-value">{{ hero.powerstats.speed }}</span>
            </div>
          </div>
          
          <!-- Appearance -->
          <div class="appearance">
            <div class="appearance-row">
              <svg class="appearance-icon" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
              </svg>
              <span>{{ hero.appearance.gender }}</span>
            </div>
            <div class="appearance-row">
              <svg class="appearance-icon" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M6.625 2.655A9 9 0 0119 11a1 1 0 11-2 0 7 7 0 00-9.625-6.492 1 1 0 11-.75-1.853zM4.662 4.959A1 1 0 014.75 6.37 6.97 6.97 0 003 11a1 1 0 11-2 0 8.97 8.97 0 012.25-5.953 1 1 0 011.412-.088z" clip-rule="evenodd"/>
              </svg>
              <span>{{ hero.appearance.race || 'Desconocida' }}</span>
            </div>
          </div>
          
          <!-- View Details Button -->
          <button class="details-btn">
            Ver Detalles
          </button>
        </div>
      </div>
    </div>

    <!-- No Results -->
    <div *ngIf="!isLoading && !error && heroes.length === 0" class="no-results">
      <p>No se encontraron superhéroes.</p>
    </div>

    <!-- Pagination con debounce -->
    <div *ngIf="totalPages > 1 && !isLoading && !error" class="pagination">
      <nav class="pagination-nav">
        <!-- First Page - SIN debounce (usa goToPage) -->
        <button (click)="goToPage(1)" 
                [disabled]="currentPage === 1"
                class="pagination-btn">
          <svg class="pagination-icon" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M15.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 010 1.414zm-6 0a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 011.414 1.414L5.414 10l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
          </svg>
        </button>
        
        <!-- Previous Page - SIN debounce -->
        <button (click)="goToPage(currentPage - 1)" 
                [disabled]="currentPage === 1"
                class="pagination-btn">
          <svg class="pagination-icon" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd"/>
          </svg>
        </button>
        
        <!-- Page Numbers - CON debounce (usa onPageChange) -->
        <ng-container *ngFor="let page of getPageNumbers()">
          <button (click)="onPageChange(page)" 
                  [class.active]="page === currentPage"
                  class="pagination-btn">
            {{ page }}
          </button>
        </ng-container>
        
        <!-- Next Page - SIN debounce -->
        <button (click)="goToPage(currentPage + 1)" 
                [disabled]="currentPage === totalPages"
                class="pagination-btn">
          <svg class="pagination-icon" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
          </svg>
        </button>
        
        <!-- Last Page - SIN debounce -->
        <button (click)="goToPage(totalPages)" 
                [disabled]="currentPage === totalPages"
                class="pagination-btn">
          <svg class="pagination-icon" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10.293 15.707a1 1 0 010-1.414L14.586 10l-4.293-4.293a1 1 0 011.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
            <path fill-rule="evenodd" d="M4.293 15.707a1 1 0 010-1.414L8.586 10 4.293 5.707a1 1 0 011.414-1.414l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
          </svg>
        </button>
      </nav>
    </div>
  </div>
</div>